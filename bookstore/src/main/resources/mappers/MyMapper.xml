<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.fullstack4.bookstore.mapper.MyMapper">
<!-- 장바구니 리스트 확인-->
    <select id="cart_list" resultType="org.fullstack4.bookstore.domain.CartListVO">
        SELECT tc.cart_idx as cart_idx, tc.or_member_id as or_member_id, tc.product_cnt as product_cnt, tc.add_date as add_date,
               tp.product_name as product_name, tp.publisher as publisher, tp.author as author,
               tp.price as price, tp.discount as discount
        FROM tbl_cart AS tc
        INNER JOIN tbl_product AS tp ON tc.product_idx = tp.product_idx
        WHERE tc.or_member_id = #{member_id}
    </select>

    <insert id="cart_add">
        INSERT INTO tbl_cart(or_member_id, product_idx, product_cnt)
        VALUES (#{or_member_id}, #{product_idx}, #{product_cnt})
    </insert>

    <select id="find_idx" resultType="int">
        SELECT COUNT(*)
        FROM tbl_cart
        WHERE product_idx = #{product_idx} AND or_member_id = #{or_member_id}
    </select>

    <update id="cart_cnt_update">
        UPDATE tbl_cart SET
        product_cnt = product_cnt + #{product_cnt}
        WHERE product_idx = #{product_idx} AND or_member_id = #{or_member_id}
    </update>
</mapper>